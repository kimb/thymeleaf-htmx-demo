<!DOCTYPE html SYSTEM "http://www.thymeleaf.org/dtd/xhtml1-strict-thymeleaf-4.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8">
    <title>Rules</title>
    <script type="text/javascript" th:src="@{/webjars/htmx.org/dist/htmx.min.js}"></script>
    <script type="text/javascript" th:src="@{/webjars/sortablejs/Sortable.min.js}"></script>
</head>
<body>
<form>
    <div id="rules" class="sortable" th:fragment="rules">
        <div th:each="rule : ${rules}">
            <input type="hidden" name="id" th:value="${rule.id}"></input>
            <span th:text="${rule.name}"></span>
        </div>
    </div>
    <input type="submit" hx-post="/order" hx-target="#rules" hx-on::after-request="makeSortable(htmx.find('#rules'))"
           value="Save"/>
    <span class="htmx-indicator">Updating...</span>
</form>

<script>
    function makeSortable(content) {
        var sortables = content.querySelectorAll(".sortable");
        for (var i = 0; i < sortables.length; i++) {
          var sortable = sortables[i];
          sort = new Sortable(sortable, {
              animation: 150,
              ghostClass: 'blue-background-class'
          });
        }
    };
    htmx.onLoad(makeSortable);
</script>
</body>
</html>